<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Gestión de Estudiantes</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<h1>Estudiantes</h1>

<form id="studentForm">
    <input type="number" id="carnet" placeholder="Carné" min="1" required>
    <input type="text" id="nombre" placeholder="Nombre" required>
    <input type="email" id="correo" placeholder="Correo" required>
    <input type="text" id="numero_telefono" placeholder="Teléfono (8 dígitos)" required>
    <select id="idioma" required>
        <option value="">Idioma</option>
        <option value="español">Español</option>
        <option value="inglés">Inglés</option>
        <option value="francés">Francés</option>
    </select>
    <button type="submit">Agregar</button>
</form>

<div id="verPorId">
    <h3>Consultar estudiante por Carné</h3>
    <input type="number" id="idBuscar" placeholder="Carné" min="1">
    <button id="btnBuscarId">Buscar</button>
    <div id="resultadoId" style="margin-top:10px;"></div>
</div>

<h2>Lista de estudiantes</h2>
<ul id="lista"></ul>

<script>
    const API = "/students";
    let estudiantes = [];

    async function cargar() {
      const res = await fetch(API);
      estudiantes = await res.json();
      renderLista(estudiantes);
    }

    function renderLista(data) {
      const lista = document.getElementById("lista");
      lista.innerHTML = "";
      data.forEach(s => {
        lista.innerHTML += `
          <li>
            <strong>#${s.carnet} - ${s.nombre}</strong><br>
            ${s.correo} | ${s.numero_telefono} | ${s.idioma}
            <br>
            <button onclick="editarCompleto(${s.carnet})">Editar completo</button>
            <button onclick="editarParcial(${s.carnet})">Editar parcial</button>
            <button onclick="borrar(${s.carnet})">Eliminar</button>
          </li>`;
      });
    }

    // crear
    document.getElementById("studentForm").addEventListener("submit", async e => {
      e.preventDefault();
      const carnetVal = Number(carnet.value);
      if (!carnetVal || carnetVal < 1) { alert("Carné debe ser positivo"); return; }

      const body = {
        carnet: carnetVal,
        nombre: nombre.value,
        correo: correo.value,
        numero_telefono: numero_telefono.value,
        idioma: idioma.value
      };

      await fetch(API, {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(body)
      });

      e.target.reset();
      cargar();
    });

    // eliminar
    async function borrar(carnet) {
      await fetch(`${API}/${carnet}`, { method: "DELETE" });
      cargar();
    }

    // editar completo (puede cambiar el carné)
    async function editarCompleto(carnetActual) {
      const res = await fetch(`${API}/${carnetActual}`);
      if (!res.ok) { alert("No encontrado"); return; }
      const s = await res.json();

      const carnetNuevo = prompt("Carné:", s.carnet);
      const nombre = prompt("Nombre:", s.nombre);
      const correo = prompt("Correo:", s.correo);
      const tel = prompt("Teléfono (8 dígitos):", s.numero_telefono);
      const idioma = prompt("Idioma (español/inglés/francés):", s.idioma);

      const body = {
        carnet: Number(carnetNuevo),
        nombre,
        correo,
        numero_telefono: tel,
        idioma
      };

      await fetch(`${API}/${carnetActual}`, {
        method: "PUT",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(body)
      });
      cargar();
    }

    // editar parcial
    async function editarParcial(carnetActual) {
      const campo = prompt("Campo a editar (carnet, nombre, correo, numero_telefono, idioma):");
      const valor = prompt("Nuevo valor:");
      if (!campo || !valor) return;

      const body = { [campo]: campo === "carnet" ? Number(valor) : valor };

      await fetch(`${API}/${carnetActual}`, {
        method: "PATCH",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(body)
      });
      cargar();
    }

    // consultar por carné
    document.getElementById("btnBuscarId").addEventListener("click", async () => {
      const carnetVal = Number(document.getElementById("idBuscar").value);
      const box = document.getElementById("resultadoId");

      if (!carnetVal || carnetVal < 1) {
        box.innerHTML = `<p style="color:red;">Ingresa un carné válido (>= 1)</p>`;
        return;
      }

      const res = await fetch(`${API}/${carnetVal}`);
      if (!res.ok) {
        box.innerHTML = `<p style="color:red;">No se encontró el estudiante con carné ${carnetVal}</p>`;
        return;
      }

      const s = await res.json();
      box.innerHTML = `
        <div style="border:1px solid #ccc; padding:10px; border-radius:6px;">
          <h4>Estudiante #${s.carnet}</h4>
          <p><strong>Nombre:</strong> ${s.nombre}</p>
          <p><strong>Correo:</strong> ${s.correo}</p>
          <p><strong>Teléfono:</strong> ${s.numero_telefono}</p>
          <p><strong>Idioma:</strong> ${s.idioma}</p>
        </div>
      `;
    });

    cargar();
</script>
</body>
</html>